generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Building {
  buildingCode   String  @id @default(uuid())
  name           String
  osmId          String?
  labelLatitude  Float
  labelLongitude Float
  shape          Json
  hitbox         Json
  floors         Floor[]
}

model Floor {
  buildingCode    String
  floorLevel      String
  isDefault       Boolean
  centerX         Float
  centerY         Float
  centerLatitude  Float
  centerLongitude Float
  scale           Float
  angle           Float
  altitude        Float?
  building        Building @relation(fields: [buildingCode], references: [buildingCode])
  Node            Node[]

  @@id([buildingCode, floorLevel])
}

model Poi {
  poiId  String @id
  type   String
  nodeId String @unique
  Node   Node   @relation(fields: [nodeId], references: [nodeId])
}

model Room {
  roomId         String  @id
  name           String
  type           String
  labelLatitude  Float
  labelLongitude Float
  polygon        Json
  buildingCode   String?
  floorLevel     String?
  aliases        Alias[]
  Node           Node[]

  @@index([buildingCode, floorLevel])
}

model Node {
  nodeId       String  @id
  latitude     Float
  longitude    Float
  buildingCode String?
  floorLevel   String?
  roomId       String?
  outEdges     Edge[]  @relation("OutEdges")
  inEdges      Edge[]  @relation("InEdges")
  floor        Floor?  @relation(fields: [buildingCode, floorLevel], references: [buildingCode, floorLevel])
  Room         Room?   @relation(fields: [roomId], references: [roomId])
  Poi          Poi?

  @@index([buildingCode, floorLevel])
}

model Edge {
  inNodeId  String
  outNodeId String
  inNode    Node   @relation("OutEdges", fields: [inNodeId], references: [nodeId])
  outNode   Node   @relation("InEdges", fields: [outNodeId], references: [nodeId])

  @@id([inNodeId, outNodeId])
}

model Alias {
  alias          String
  isDisplayAlias Boolean
  roomId         String
  room           Room    @relation(fields: [roomId], references: [roomId])

  @@id([roomId, alias])
}
